{% macro nav_link(endpoint, name) %}
{% if request.endpoint.endswith(endpoint) %}
<li class="active"><a href="{{ url_for(endpoint) }}">{{name}}</a></li>
{% else %}
<li><a href="{{ url_for(endpoint) }}">{{name}}</a></li>
{% endif %}
{% endmacro %}

{% macro upload_dialog_script(key) %}
  dialog_{{ key }}_upload = $( "#upload_{{ key }}_dialog" ).dialog({
    autoOpen: false,
    height: 400,
    width: 350,
    modal: true,
    open: function() {
      $("#dlg_{{ key }}_msg_span").hide();
    },
    buttons: [
      {
        text: "Upload",
	click: function() {
	  if ( $("#upload_{{ key }}_file").val() ) {
	    $("#upload_{{ key }}_form").submit();
	  } else {
	    $("#dlg_{{ key }}_msg_span").text("No file selected.").show();
	  }
	},
	type: "submit",
	form: "upload_{{ key }}_form"
	},
      {
	text: "Cancel",
	click: function() {
          dialog_{{ key }}_upload.dialog( "close" );
	  }
      	}
    ]
  });
{% endmacro %}

{% macro upload_dialog_content(key, title, endpoint, msg) %}
  <div id="upload_{{ key }}_dialog" title="{{ title }}">
    <h1>{{ title }}</h1>
    <form id="upload_{{ key }}_form"
          method=post
	  action="{{ endpoint }}"
          enctype=multipart/form-data>
      <input type=file name=file id="upload_{{ key }}_file">
    </form>
    {{ msg }}
    <br>
    <span id="dlg_{{ key }}_msg_span"
	  class="alert alert-warning" role="alert"></span>
  </div>
{% endmacro %}

{% macro updown_button_script_preamble(key) %}
var dialog_{{ key }}_upload;
{% endmacro %}

{% macro updown_button_script(key, download_endpoint, sel_fun_name) %}
  $("#download_{{ key }}_button").click( function() {
    var url = "{{ download_endpoint }}?" + {{ sel_fun_name }}();
    $("#download_{{ key }}_link").attr('href', url);
    $("#download_{{ key }}_link")[0].click();
  });
  $("#upload_{{ key }}_button").click( function() {
    dialog_{{ key }}_upload.dialog( "open" );
  });
  {{ upload_dialog_script(key) }}
{% endmacro %}

{% macro updown_button_content(key, label,
  upload_dlg_title, upload_endpoint, download_endpoint,
  upload_dlg_msg) %}
  <input type="BUTTON" id="upload_{{ key }}_button"
	 value="Upload {{ label }}">
  <div id="download_{{ key }}_div">
    <button id="download_{{ key }}_button">Download {{ label }}</button>
    <a id="download_{{ key }}_link" href="{{ download_endpoint }}"></a>
  </div>

  {{ upload_dialog_content(key, upload_dlg_title,
       upload_endpoint, upload_dlg_msg) }}  
{% endmacro %}

{% macro jqgrid_boilerplate() %}
    datatype: "json",
    rowNum:10,
    rowList:[5,10,20,30],
    pager: true,
    sortorder: "desc",
    guiStyle: "bootstrap",
    iconSet: "fontAwesome",
    cmTemplate: { autoResizable: true },
    autoresizeOnLoad: true,
    loadonce: true,
    loadError: function (jqXHR, textStatus, errorThrown) {
        alert('HTTP status code: ' + jqXHR.status + '' +
              'textStatus: ' + textStatus + ' ' +
              'errorThrown: ' + errorThrown);
        alert('HTTP message body (jqXHR.responseText): '
	    + ' ' + jqXHR.responseText);
    },
    reloadGridOptions: { fromServer: true, reloadAfterSubmit: true }  
{% endmacro %}
